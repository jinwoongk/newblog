<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Act as a catalyst RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Act as a catalyst Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Act as a catalyst JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-4ZT898XDT2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZT898XDT2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4ZT898XDT2",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloud Catalyst" href="/opensearch.xml">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4362752107119680" crossorigin="anonymous"></script><title data-rh="true">git-sync | Cloud Catalyst</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ddii.dev/2019/03/21/git-sync"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="naver-site-verification" content="cbcc03783e5594725d3951f4e7f16ede80e69881"><meta data-rh="true" property="og:title" content="git-sync | Cloud Catalyst"><meta data-rh="true" name="description" content="git-sync에 대해서 알아본다."><meta data-rh="true" property="og:description" content="git-sync에 대해서 알아본다."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-03-21T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="git-sync,GitOps,Kubernetes,ssh git,sidecar,sidecar pattern"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ddii.dev/2019/03/21/git-sync"><link data-rh="true" rel="alternate" href="https://ddii.dev/2019/03/21/git-sync" hreflang="ko"><link data-rh="true" rel="alternate" href="https://ddii.dev/2019/03/21/git-sync" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://J5EMWGFKQM-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.1e7a31ee.css">
<link rel="preload" href="/assets/js/runtime~main.13cb0e78.js" as="script">
<link rel="preload" href="/assets/js/main.5e59ad0e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">본문으로 건너뛰기</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_transparent.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo_transparent.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Cloud Catalyst</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Posts</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="intro" href="/docs/intro">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/intro">Intro</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/presentation">Presentation</a><a class="navbar__item navbar__link" href="/archive">Archive</a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/pang4u">Pang4u</a><a href="https://github.com/ddiiwoong/newblog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="검색"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">검색</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_uKok margin-bottom--md">최근 게시물</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/03/18/eks-anywhere-adv">EKS Anywhere Advanced Usages</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/03/06/eks-anywhere">EKS Anywhere on vSphere Homelab</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/02/05/what-is-tailscale">What is Tailscale?</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2021/06/11/synology-prometheus">Synology monitoring with Prometheus and snmp exporter</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2020/12/06/vSphere-with-Tanzu-homelab-2">vSphere with Tanzu homelab running on ASUS PN50 (2/2)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">git-sync</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-03-21T00:00:00.000Z" itemprop="datePublished">2019년 3월 21일</time> · <!-- -->약 9분</div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>git repo를 kubernetes volume으로 구현할수 있는 sidecar pattern <code>git-sync</code> 프로젝트에 대해서 알아본다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="git-sync">git-sync<a class="hash-link" href="#git-sync" title="제목으로 바로 가기">​</a></h2><p><a href="https://github.com/kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes Github</a>에 방문하면 다양한 프로젝트들을 볼 수 있다.<br>
<a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes Project</a>부터 minikube, kubeadm, kubectl, kubelet, dashboard등 필수적으로 필요하거나 많이 사용되는 프로젝트를 볼 수 있는데,
기존에 storage volume 으로 활용되던 <a href="https://kubernetes.io/docs/concepts/storage/volumes/#gitrepo" target="_blank" rel="noopener noreferrer">gitrepo</a>가 <code>deprecated</code> 되어서 방법을 찾다가 유사한 프로젝트를 공식 repo에서 우연히 발견하게 되었다.  </p><p><a href="https://github.com/kubernetes/git-sync" target="_blank" rel="noopener noreferrer">git-sync</a>는 sidecar 방식으로 git repository를 clone하는 프로젝트이다.  </p><p>최초 한번 clone도 가능하고 일정한 간격으로 끌어와서 응용프로그램에 사용할 수 있고 원하는 branch, Tag 또는 특정 git hash 기반으로 pulling이 가능하다.  </p><p>upstream의 repository에서 대상이 변경되었을때 다시 pulling하고, webhook기능을 추가하여 비동기성으로 POST 요청이 있을때만 git-sync를 수행할수 있기 때문에
Continuous Deployment를 간단하게 구현하는데 활용될 수 있다. </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="github-ssh설정">GitHub SSH설정<a class="hash-link" href="#github-ssh설정" title="제목으로 바로 가기">​</a></h2><p>git 내용을 pulling을 할때 https, ssh 방법을 사용하는데 GitHub ssh key를 kubernetes cluster의 secret으로 사용을 할수 있기 때문에 ssh 방식을 사용하는 방법을 작성하였다.  </p><p>아래 모든 과정은 MacOS에서 진행하였고 다른 OS는 아래 링크에서 확인 가능하다.<br>
<a href="https://help.github.com/en/articles/connecting-to-github-with-ssh" target="_blank" rel="noopener noreferrer">https://help.github.com/en/articles/connecting-to-github-with-ssh</a></p><p>사용하고자 하는 터미널에서 등록키를 확인하자.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="기존에-등록된-ssh-key-확인">기존에 등록된 SSH key 확인<a class="hash-link" href="#기존에-등록된-ssh-key-확인" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -al ~/.ssh</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="새로운-ssh-key-생성">새로운 SSH key 생성<a class="hash-link" href="#새로운-ssh-key-생성" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-keygen -t rsa -b 4096 -C &quot;ddiiwoong@gmail.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start the SSH key creation process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Enter file in which the key is (/Users/you/.ssh/id_rsa): [Hit enter]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Key has comment &#x27;/Users/you/.ssh/id_rsa&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Enter new passphrase (empty for no passphrase): [Type new passphrase]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Enter same passphrase again: [One more time for luck]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Your identification has been saved with the new passphrase.</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ssh-agent-실행중인지-확인">ssh agent 실행중인지 확인<a class="hash-link" href="#ssh-agent-실행중인지-확인" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">eval “$(ssh-agent -s)”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Agent pid 59566</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="생성된-키를-keychain에-저장-및-확인">생성된 키를 keychain에 저장 및 확인<a class="hash-link" href="#생성된-키를-keychain에-저장-및-확인" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-add -K ~/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat ~/.ssh/id_rsa.pub</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="복사-및-github에-추가">복사 및 github에 추가<a class="hash-link" href="#복사-및-github에-추가" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ pbcopy &lt; ~/.ssh/id_rsa.pub</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Setting - SSH and GPG keys - SSH keys - New SSH key<br>
<code>Title</code>은 구분자로 입력하고 GitHub password를 한번더 입력하고 완료한다.  </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="터미널에서-ssh접속-확인">터미널에서 SSH접속 확인<a class="hash-link" href="#터미널에서-ssh접속-확인" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh -T git@github.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hi ddiiwoong! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="git-sync를-위한-secret-등록">git-sync를 위한 secret 등록<a class="hash-link" href="#git-sync를-위한-secret-등록" title="제목으로 바로 가기">​</a></h2><p><a href="https://github.com/kubernetes/git-sync/blob/master/docs/ssh.md" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/git-sync/blob/master/docs/ssh.md</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="secret-생성">secret 생성<a class="hash-link" href="#secret-생성" title="제목으로 바로 가기">​</a></h3><p>위에서 생성한 SSH key를 Kubernetes Cluster에 Secret resource로 저장을 한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-keyscan github.com &gt; /tmp/known_hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># github.com:22 SSH-2.0-babeld-9d924d26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># github.com:22 SSH-2.0-babeld-9d924d26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># github.com:22 SSH-2.0-babeld-9d924d26</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>known_hosts와 key를 Secret으로 저장한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create secret generic git-creds \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --from-file=ssh=$HOME/.ssh/id_rsa \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --from-file=known_hosts=/tmp/known_hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get secret git-creds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        TYPE      DATA      AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git-creds   Opaque    2         1d</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="sample-ngnix-배포">sample ngnix 배포<a class="hash-link" href="#sample-ngnix-배포" title="제목으로 바로 가기">​</a></h2><p>기본적으로 <code>git-sync/cmd/git-sync/main.go</code> 소스를 확인하면 여러가지 flag를 확인할 수 있는데 주로 사용하는 옵션은 다음과 같다.</p><ul><li>ssh : pulling 방식 (default=false)</li><li>root : git clone이 수행되는 root directory (default=&quot;$HOME/git&quot;)</li><li>repo : clone 대상 Repository (default=&quot;&quot;)</li><li>branch : branch (default=master)</li><li>rev : git revision (tag or hash) to check out</li><li>depth : commit depth (default=0)</li><li>dest : repository 배포 directory</li></ul><p>기타 옵션들은 <code>git-sync/cmd/git-sync/main.go</code> 에서 확인이 가능하며 해당 옵션들을 변수로 처리하여 활용하면 된다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="git-sync-demoyaml-작성">git-sync-demo.yaml 작성<a class="hash-link" href="#git-sync-demoyaml-작성" title="제목으로 바로 가기">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: nginx:1.14-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /usr/share/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: k8s.gcr.io/git-sync:v3.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-ssh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-repo=git@github.com:ddiiwoong/git-sync-demo.git&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-root=/usr/share/nginx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-dest=html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-branch=master&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - &quot;-depth=1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /usr/share/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /etc/git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emptyDir: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          secretName: git-creds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          defaultMode: 288 # = mode 0440</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fsGroup: 65533 # to make SSH key readable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: git-sync-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targetPort: 80</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="확인사항">확인사항<a class="hash-link" href="#확인사항" title="제목으로 바로 가기">​</a></h3><p>일단 ngnix로 1.14-alpine Image를 기본으로 하고 git-sync container가 sidecar로 들어가도록 작성하였다.<br>
<!-- -->실제 동작하는 순서대로 manifest를 아래서부터 살펴보자.</p><ul><li>git-sync-volume은 <code>emptyDir</code>, git-secret은 <code>secret</code> volume 설정<div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emptyDir: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      secret:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secretName: git-creds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        defaultMode: 288 # = mode 0440</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li>sidecar container image를 <code>k8s.gcr.io/git-sync:v3.1.1</code>로 설정</li><li><code>git-sync-volume</code>, <code>git-sync-volume</code> volume을 <code>git-sync</code> sidecar에 마운트</li><li>위에서 이야기한 <code>git-sync</code> flag, args로 설정<div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: git-sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: k8s.gcr.io/git-sync:v3.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imagePullPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-ssh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-repo=git@github.com:ddiiwoong/git-sync-demo.git&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-root=/usr/share/nginx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-dest=html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-branch=master&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       - &quot;-depth=1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mountPath: /usr/share/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mountPath: /etc/git-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li>nginx 기본 위치가 <code>/usr/share/nginx</code> 이므로 mount 위치를 git-sync-volume으로 설정<div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: nginx:1.14-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: git-sync-volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mountPath: /usr/share/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><p>위 nginx를 배포하고 접속하면 <code>Hello git-sync demo v1.0</code>를 확인할 수 있다.</p><p>결국 git repo code (static html page)는 <code>/usr/share/nginx/html</code> 위치에 clone 되는것처럼 보이지만
실제 clone 위치를 확인해보면 symbolic link로 특정 revision dir를 가리키고 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec -it git-sync-demo-665c9c9ddf-6nwc4 sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Defaulting container name to nginx.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Use &#x27;kubectl describe pod/git-sync-demo-665c9c9ddf-6nwc4 -n default&#x27; to see all of the containers in this pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ # cd /usr/share/nginx/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx # ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwsrwx    4 root     nogroup       4096 Mar 21 06:54 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x    1 root     root          4096 Mar  8 03:09 ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-sr-x    9 65533    nogroup       4096 Mar 21 06:54 .git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx    1 65533    nogroup         44 Mar 21 06:54 html -&gt; rev-07aa36f719091d75b5665203fa5846a549e7d540</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-sr-x    2 65533    nogroup       4096 Mar 21 06:54 rev-07aa36f719091d75b5665203fa5846a549e7d540</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx # cat ./html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;title&gt;Hello git-sync demo&lt;/title&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;Hello git-sync demo v1.0&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>github에 있는 위 index.html 내용을 수정하고 commit을 하게 되면 실시간으로 아래와 같이 revision 정보 및 내용이 바뀐것을 확인할수 있다.  </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx # ls -al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwsrwx    4 root     nogroup       4096 Mar 21 13:40 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x    1 root     root          4096 Mar  8 03:09 ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-sr-x    9 65533    nogroup       4096 Mar 21 13:40 .git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx    1 65533    nogroup         44 Mar 21 13:40 html -&gt; rev-b125908649135856d79c515c17decba68797a6cb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-sr-x    2 65533    nogroup       4096 Mar 21 13:40 rev-b125908649135856d79c515c17decba68797a6cb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx # cat ./html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;title&gt;Hello git-sync demo&lt;/title&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;Hello git-sync demo v1.1&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="정리">정리<a class="hash-link" href="#정리" title="제목으로 바로 가기">​</a></h2><p>git-sync를 간단하게 테스트해봤다.<br>
<!-- -->간단하게 <code>sidecar</code> 방식의 clone tool로서 <code>git-sync</code>를 활용하면 여러가지로 충분히 활용이 가능할 것이다.<br>
<!-- -->포스팅을 작성하면서 떠오른 활용용도를 정리하면 아래와 같다. 어찌보면 sidecar pattern의 활용방안이라고도 볼수 있다.</p><ul><li>CDN을 사용하지 않고 git에서 소규모로 컨텐츠를 가져올때</li><li>DBMS가 필요없을 정도의 적은 데이터를 가져올때</li><li>jekyll이나 hugo 같은 정적 사이트(블로그)의 sidecar 패턴 (GitPage처럼 markdown을 추가하고 git commit하면 바로 사이트에 반영되는 방식)</li><li>nginx, haproxy, apache와 같이 config 변경이 필요할때 webhook방식으로 설정을 변경한후 pod를 재기동하는 GitOps 구현</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>태그:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/git-sync">git-sync</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/git-ops">GitOps</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ssh-git">ssh git</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/sidecar">sidecar</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/sidecar-pattern">sidecar pattern</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-21-git-sync.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div></footer></article><div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2019/03/29/eksworkshop"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">eksworkshop</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2019/03/20/vscode-server"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">VScode Server</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#git-sync" class="table-of-contents__link toc-highlight">git-sync</a></li><li><a href="#github-ssh설정" class="table-of-contents__link toc-highlight">GitHub SSH설정</a><ul><li><a href="#기존에-등록된-ssh-key-확인" class="table-of-contents__link toc-highlight">기존에 등록된 SSH key 확인</a></li><li><a href="#새로운-ssh-key-생성" class="table-of-contents__link toc-highlight">새로운 SSH key 생성</a></li><li><a href="#ssh-agent-실행중인지-확인" class="table-of-contents__link toc-highlight">ssh agent 실행중인지 확인</a></li><li><a href="#생성된-키를-keychain에-저장-및-확인" class="table-of-contents__link toc-highlight">생성된 키를 keychain에 저장 및 확인</a></li><li><a href="#복사-및-github에-추가" class="table-of-contents__link toc-highlight">복사 및 github에 추가</a></li><li><a href="#터미널에서-ssh접속-확인" class="table-of-contents__link toc-highlight">터미널에서 SSH접속 확인</a></li></ul></li><li><a href="#git-sync를-위한-secret-등록" class="table-of-contents__link toc-highlight">git-sync를 위한 secret 등록</a><ul><li><a href="#secret-생성" class="table-of-contents__link toc-highlight">secret 생성</a></li></ul></li><li><a href="#sample-ngnix-배포" class="table-of-contents__link toc-highlight">sample ngnix 배포</a><ul><li><a href="#git-sync-demoyaml-작성" class="table-of-contents__link toc-highlight">git-sync-demo.yaml 작성</a></li><li><a href="#확인사항" class="table-of-contents__link toc-highlight">확인사항</a></li></ul></li><li><a href="#정리" class="table-of-contents__link toc-highlight">정리</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pang4u">Pang4U</a></li><li class="footer__item"><a href="https://ko-fi.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Me a Coffee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kr.linkedin.com/in/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.13cb0e78.js"></script>
<script src="/assets/js/main.5e59ad0e.js"></script>
</body>
</html>