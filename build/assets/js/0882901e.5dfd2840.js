"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[2296],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,k=m["".concat(o,".").concat(d)]||m[d]||u[d]||i;return n?a.createElement(k,l(l({ref:t},s),{},{components:n})):a.createElement(k,l({ref:t},s))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:r,l[1]=c;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},80544:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return c},metadata:function(){return p},toc:function(){return u}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),l=["components"],c={layout:"single",title:"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131",comments:!0,classes:"wide",slug:"devops/circleci-ecs/",date:new Date("2019-06-30T00:00:00.000Z"),categories:["DevOps"],tags:["DevOps","CI/CD","Pipeline","CircleCI","GitHub","GitOps","ECS","AWS Batch"]},o=void 0,p={permalink:"/devops/circleci-ecs/",editUrl:"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-06-30-circleci-ecs.md",source:"@site/blog/2019-06-30-circleci-ecs.md",title:"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131",description:"\uc774\uc804 \ud3ec\uc2a4\ud305\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\uc640 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uac04\ub2e8\ud558\uac8c \ud574\ubd24\ub2e4.  \uc774\ubc88\uc5d0\ub294 AWS ECS \ub610\ub294 AWS Batch Application\uc744 CircleCI\ub97c \ud1b5\ud574 \ubc30\ud3ec \ubc0f \uc5c5\ub370\uc774\ud2b8 \ud558\ub294 \uac83\uc744 \uc54c\uc544\ubcf8\ub2e4.",date:"2019-06-30T00:00:00.000Z",formattedDate:"June 30, 2019",tags:[{label:"DevOps",permalink:"/tags/dev-ops"},{label:"CI/CD",permalink:"/tags/ci-cd"},{label:"Pipeline",permalink:"/tags/pipeline"},{label:"CircleCI",permalink:"/tags/circle-ci"},{label:"GitHub",permalink:"/tags/git-hub"},{label:"GitOps",permalink:"/tags/git-ops"},{label:"ECS",permalink:"/tags/ecs"},{label:"AWS Batch",permalink:"/tags/aws-batch"}],readingTime:10.595,truncated:!1,authors:[],frontMatter:{layout:"single",title:"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131",comments:!0,classes:"wide",slug:"devops/circleci-ecs/",date:"2019-06-30T00:00:00.000Z",categories:["DevOps"],tags:["DevOps","CI/CD","Pipeline","CircleCI","GitHub","GitOps","ECS","AWS Batch"]},prevItem:{title:"2019 Retrospective",permalink:"/retrospective/2020plan/"},nextItem:{title:"CircleCI - GitHub \uc5f0\ub3d9 \ubc0f EKS \uad6c\uc131\ud558\uae30",permalink:"/devops/circleci/"}},s={authorsImageUrls:[]},u=[{value:"Application \uc694\uad6c\uc0ac\ud56d",id:"application-\uc694\uad6c\uc0ac\ud56d",level:2},{value:"\uae30\ubcf8 \uc694\uad6c\uc0ac\ud56d",id:"\uae30\ubcf8-\uc694\uad6c\uc0ac\ud56d",level:3},{value:"CI/CD \uad6c\uc131\uc548",id:"cicd-\uad6c\uc131\uc548",level:2},{value:"AWS Batch",id:"aws-batch",level:3},{value:"CircleCI",id:"circleci",level:3},{value:"Amazon Elastic Container Registry (ECR)",id:"amazon-elastic-container-registry-ecr",level:3},{value:"Terraform",id:"terraform",level:3},{value:"CircleCI Config \uc791\uc131",id:"circleci-config-\uc791\uc131",level:2},{value:"CircleCI \uc2e4\ud589",id:"circleci-\uc2e4\ud589",level:2},{value:"README.md\uc5d0 Build Status Badge \ub2ec\uae30",id:"readmemd\uc5d0-build-status-badge-\ub2ec\uae30",level:2},{value:"\uc815\ub9ac",id:"\uc815\ub9ac",level:2}],m={toc:u};function d(e){var t=e.components,c=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},m,c,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://ddii.dev/devops/circleci/"},"\uc774\uc804 \ud3ec\uc2a4\ud305"),"\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\uc640 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uac04\ub2e8\ud558\uac8c \ud574\ubd24\ub2e4.  \uc774\ubc88\uc5d0\ub294 AWS ECS \ub610\ub294 AWS Batch Application\uc744 CircleCI\ub97c \ud1b5\ud574 \ubc30\ud3ec \ubc0f \uc5c5\ub370\uc774\ud2b8 \ud558\ub294 \uac83\uc744 \uc54c\uc544\ubcf8\ub2e4.  "),(0,i.kt)("h2",{id:"application-\uc694\uad6c\uc0ac\ud56d"},"Application \uc694\uad6c\uc0ac\ud56d"),(0,i.kt)("p",null,"\uae30\ubcf8\uc801\uc73c\ub85c \ud604\uc7ac \uc5c5\ubb34 \uc911\uc5d0 IBM\ud074\ub77c\uc6b0\ub4dc\uc5d0\uc11c AWS\ub85c \ub370\uc774\ud130\ub97c \uac00\uc838\uc640\uc57c \ud558\ub294 \uc5c5\ubb34\uac00 \uc0dd\uaca8\uc11c \uc2dc\uc791\ub418\uc5c8\uace0 \uc815\uae30\uc801\uc73c\ub85c \ub9e4\uc77c \uc0c8\ubcbd\uc5d0 \ud06c\ub864\ub9c1(Pull)\ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcf5\uc81c\ud574\uc57c\ud558\ub294 Use-Case\ub97c \uad6c\ud604\ud574\uc57c \ud588\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","CI/CD Pipeline\uad6c\uc131\uc774 \uc8fc \ubaa9\uc801\uc73c\ub85c Application\uad6c\ud604\uc740 \ud3ec\uc2a4\ud305 \ub0b4\uc6a9\uc5d0\uc11c \uc81c\uc678\ud558\uc600\ub2e4.  "),(0,i.kt)("h3",{id:"\uae30\ubcf8-\uc694\uad6c\uc0ac\ud56d"},"\uae30\ubcf8 \uc694\uad6c\uc0ac\ud56d"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Github Account"),(0,i.kt)("li",{parentName:"ul"},"CircleCI Account (Github Auth)"),(0,i.kt)("li",{parentName:"ul"},"AWS ECR(Elastic Container Registry)"),(0,i.kt)("li",{parentName:"ul"},"AWS Batch(ECS) ")),(0,i.kt)("h2",{id:"cicd-\uad6c\uc131\uc548"},"CI/CD \uad6c\uc131\uc548"),(0,i.kt)("p",null,"\uc2e4\uc81c \ud504\ub85c\uc81d\ud2b8\uc5d0 \uc801\uc6a9\ud560 \uad6c\uc131\uc548\uc774\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uae30\ubcf8\uc801\uc73c\ub85c \ubaa8\ub4e0 \uad6c\uc131\uc740 \ucd5c\ub300\ud55c \ube44\uc6a9\uc774 \ub4e4\uc9c0 \uc54a\uace0 AWS \uc885\uc18d\uc131\uc744 \uc81c\uac70\ud55c \ubc29\ubc95\uc73c\ub85c \uad6c\uc131\ud558\uc600\ub2e4.  "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Code Repository : Github"),(0,i.kt)("li",{parentName:"ul"},"CI : CircleCI"),(0,i.kt)("li",{parentName:"ul"},"Registry : AWS ECR"),(0,i.kt)("li",{parentName:"ul"},"CD : CircleCI"),(0,i.kt)("li",{parentName:"ul"},"Target : AWS Batch(ECS)"),(0,i.kt)("li",{parentName:"ul"},"Notification : Slack")),(0,i.kt)("p",null,"\uc774\ubc88 \ub370\ubaa8\uc5d0\uc11c\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uc2dc\ub098\ub9ac\uc624\ub85c \uc9c4\ud589\ud558\ub824\uace0 \ud55c\ub2e4.  "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Terraform\uc73c\ub85c AWS Batch \uc0dd\uc131"),(0,i.kt)("li",{parentName:"ol"},"Github\uc5d0 \uc218\uc815\ub41c Batch Code(Shell Script) Commit & Triggering CircleCI"),(0,i.kt)("li",{parentName:"ol"},"Docker Build & AWS ECR\ub85c Push"),(0,i.kt)("li",{parentName:"ol"},"S3\ub85c myjob shell \ud30c\uc77c \ubcf5\uc0ac"),(0,i.kt)("li",{parentName:"ol"},"AWS Batch(ECS) Job Definition \ubcc0\uacbd(Change Image)")),(0,i.kt)("h3",{id:"aws-batch"},"AWS Batch"),(0,i.kt)("p",null,"\uae30\ubcf8\uc801\uc73c\ub85c Batch \ucef4\ud4e8\ud305\uc744 \ubaa9\uc801\uc73c\ub85c \ud558\ub294 \uc11c\ube44\uc2a4\ub85c \ucef4\ud4e8\ud305 \ud0c0\uc785\uc744 Fargate \ub610\ub294 EC2 \uc911 \ud558\ub098\ub97c \uc120\ud0dd\ud558\uc5ec \ub3d9\uc801\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uc11c\ube44\uc2a4\uc774\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\ucd08\uae30 \uc124\uc815\uc774 \ubc88\uac70\ub86d\uae34 \ud558\uc9c0\ub9cc \ud55c\ubc88 \uad6c\uc131\ud558\uace0 \ub098\uba74 \ubcc4\ub3c4 \uad00\ub9ac\uac00 \ud544\uc694\uc5c6\uace0 Batch\uc791\uc5c5\uc774 \ubc1c\uc0dd\ud558\ub294\uac83\uacfc \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \ubcf4\uad00\ube44\uc6a9 \uc774\uc678\uc5d0\ub294 \ucd94\uac00 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \ube44\uc6a9\uce21\uba74\uc5d0\uc11c \uc7a5\uc810\uc774 \uc788\ub294 \uc11c\ube44\uc2a4\uc774\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud55c \uc815\uae30\uc801\uc73c\ub85c \uc0c8\ubcbd\ub9c8\ub2e4 \ud06c\ub864\ub9c1(Pull)\ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcf5\uc81c\ud574\uc57c\ud558\ub294 Use-Case\ub97c \uad6c\ud604\ud558\ub294\uac83\uc774 \uc801\ub2f9\ud55c \uc6cc\ud06c\ub85c\ub4dc \uad6c\ud604\ubc29\ubc95\uc774\ub77c \uc0dd\uac01\ud588\uae30 \ub54c\ubb38\uc5d0 AWS Batch \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uc5c8\ub2e4.  "),(0,i.kt)("p",null,"\uac04\ub2e8\ud55c Batch demo\ub294 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/awslabs/aws-batch-helpers/"},"https://github.com/awslabs/aws-batch-helpers/"),"\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\uba70 CircleCI\uc5f0\ub3d9\uc744 \uc704\ud574 Fork\ud6c4  \uc9c4\ud589\ud558\uc600\ub2e4."),(0,i.kt)("p",null,"Demo Repository : ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ddiiwoong/aws-batch-helpers/"},"https://github.com/ddiiwoong/aws-batch-helpers/")),(0,i.kt)("h3",{id:"circleci"},"CircleCI"),(0,i.kt)("p",null,"\ubaa8\ub4e0 Pipeline\uc740 CircleCI\uae30\ubc18\uc73c\ub85c \uc791\uc131\ud558\uc600\ub2e4.  \ud639\uc790\ub294 AWS Code Commit, Pipeline\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub290\ub0d0\uace0 \ubb38\uc758\ud558\uc2dc\ub294 \ubd84\ub4e4\ub3c4 \uc788\ub294\ub370 \ub2e4\uc74c\uacfc \uac19\uc740 \uc774\uc720\ub85c CircleCI\ub97c \uc120\ud0dd\ud558\uc600\ub2e4.  "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Fully Managed (Serverless)"),(0,i.kt)("li",{parentName:"ul"},"AWS \uc885\uc18d\uc131 \ucd5c\uc18c\ud654  "),(0,i.kt)("li",{parentName:"ul"},"Git, Registry, CD\uc601\uc5ed\uc758 \ud655\uc7a5\uc131 \uace0\ub824"),(0,i.kt)("li",{parentName:"ul"},"AWS Console \uc811\uc18d \ucd5c\uc18c\ud654"),(0,i.kt)("li",{parentName:"ul"},"\uc27d\uace0 \ub2e8\uc21c\ud558\uac8c \ube4c\ub4dc \ud658\uacbd\uad6c\uc131"),(0,i.kt)("li",{parentName:"ul"},"\uc18c\uaddc\ubaa8 \ud504\ub85c\uc81d\ud2b8 \ube60\ub974\uac8c \uc2dc\uc791 \uac00\ub2a5")),(0,i.kt)("h3",{id:"amazon-elastic-container-registry-ecr"},"Amazon Elastic Container Registry (ECR)"),(0,i.kt)("p",null,"\uac1c\uc778\uc801\uc73c\ub85c Registry\ub294 \uad6c\ucd95\ud615\ubcf4\ub2e4\ub294 Managed\uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294\uac83\uc774 \uc88b\ub2e4\uace0 \ubcf4\uae30 \ub54c\ubb38\uc5d0 Webhook\uc744 Native\ud558\uac8c \uc9c0\uc6d0\ud558\ub294 DockerHub\ub3c4 \ub300\uccb4 \uac00\ub2a5\ud558\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.  "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Fully Managed"),(0,i.kt)("li",{parentName:"ul"},"Security (IAM) \uc5f0\ub3d9"),(0,i.kt)("li",{parentName:"ul"},"CircleCI Orbs \uc81c\uacf5"),(0,i.kt)("li",{parentName:"ul"},"EKS, ECS \uc5f0\ub3d9 \uc6a9\uc774")),(0,i.kt)("h3",{id:"terraform"},"Terraform"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/providers/aws/index.html"},"https://www.terraform.io/docs/providers/aws/index.html"),"  "),(0,i.kt)("p",null,"\uc120\uc5b8\uc801 \uc778\ud504\ub77c\uc2a4\ud2b8\ub7ed\ucc98 \uad00\ub9ac \ub3c4\uad6c\ub85c \ub9ce\uc774 \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \ub3c4\uad6c\uc774\uba70 Docs\uc640 \ube14\ub85c\uadf8 \uc790\ub8cc\uac00 \ub9ce\uc740 \uad00\uacc4\ub85c \ub530\ub85c \uc124\uba85\ud558\uc9c0 \uc54a\uaca0\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 AWS Batch\ub97c \uc0dd\uc131\ud558\ub294 \uc601\uc5ed\uc744 Terraform\uc774 \ub2f4\ub2f9\ud55c\ub2e4.  "),(0,i.kt)("h2",{id:"circleci-config-\uc791\uc131"},"CircleCI Config \uc791\uc131"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'version: 2.1\norbs:\n  aws-ecr: circleci/aws-ecr@6.1.0\n  aws-ecs: circleci/aws-ecs@0.0.8\n  aws-s3: circleci/aws-s3@1.0.11\n  aws-cli: circleci/aws-cli@0.1.13\njobs:\n  sh-s3-upload:\n    docker:\n      - image: \'circleci/python:2.7\'\n    steps:\n      - checkout\n      - aws-s3/copy:\n          from: ./myjob.sh\n          to: \'s3://batch-ecr-test/myjob.sh\'\n  deploy-batch:\n    executor: aws-cli/default\n    steps:\n      - checkout\n      - aws-cli/install\n      - run:\n          name: Update AWS Batch Job\n          command: |\n            aws batch register-job-definition --job-definition-name fetch_and_run --type container --container-properties \'{ "image": "823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623", "vcpus": 1, "memory": 512}\'\nworkflows:\n  build-and-deploy:\n    jobs:\n      - aws-ecr/build-and-push-image:\n          repo: $AWS_RESOURCE_NAME_PREFIX\n          tag: v20190623\n      - sh-s3-upload:\n          name: sh-s3-upload\n          requires:\n            - aws-ecr/build-and-push-image\n      - deploy-batch:\n          name: deploy-batch\n          requires:\n            - sh-s3-upload\n')),(0,i.kt)("p",null,"\ub2e8\uacc4\ubcc4 \uc124\uba85\uc744 \uc704\ud574 \ubd80\ubd84\uc801\uc73c\ub85c \uc124\uba85\ud558\ub3c4\ub85d \ud558\uaca0\ub2e4.  "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Terraform\uc73c\ub85c Batch \ubc30\ud3ec"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'resource "aws_batch_compute_environment" "default"{ \n  compute_environment_name = "env_fetch_and_run" \n  compute_resources { \n    instance_role = "arn:aws:iam::823928750534:instance-profile/ecsInstanceRole" \n    instance_type = [\n      "optimal",\n    ]\n    desired_vcpus = 1 \n    max_vcpus = 1 \n    min_vcpus = 0 \n    security_group_ids = [\n      "sg-0632cf81b5c4dff17" \n    ]\n    subnets = [\n      "subnet-0c4f8135b536e8fab",\n      "subnet-0a261950d894cf27e"\n    ] \n    type = "EC2" \n  } \n  service_role = "arn:aws:iam::823928750534:role/service-role/AWSBatchServiceRole" \n  type ="MANAGED"\n}\n')),(0,i.kt)("p",{parentName:"li"},"Batch Computing \ud658\uacbd\uc744 \uad6c\uc131\ud558\uac8c \ub418\ub294\ub370 ",(0,i.kt)("inlineCode",{parentName:"p"},'"aws_batch_compute_environment"'),"\ub97c \uc0ac\uc6a9\ud55c\ub2e4.  "),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"compute_environment_name : (\ud544\uc218) \ucef4\ud4e8\ud305 \ud658\uacbd \uc774\ub984"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.instance_role : (\ud544\uc218) EC2\uc5d0 \uc801\uc6a9\ub418\ub294 Role"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.instance_type : (\ud544\uc218) \uc0ac\uc6a9 \uac00\ub2a5\ud55c instance \uc720\ud615"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.desired_vcpus : (\uc635\uc158) \uc6d0\ud558\ub294 CPU\uc218"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.max_vcpus : (\ud544\uc218) \ucd5c\ub300 CPU\uc218  "),(0,i.kt)("li",{parentName:"ul"},"compute_resources.min_vcpus : (\ud544\uc218) \ucd5c\uc18c CPU\uc218"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.security_group_ids : (\ud544\uc218) EC2\uc5d0 \uc801\uc6a9\ub418\ub294 Security Group"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.subnets : (\ud544\uc218) Subnets \ubaa9\ub85d"),(0,i.kt)("li",{parentName:"ul"},"compute_resources.type : (\ud544\uc218) EC2\ub97c \uae30\ubc18\uc73c\ub85c \uc0dd\uc131, SPOT instance \uc0ac\uc6a9\uac00\ub2a5  "),(0,i.kt)("li",{parentName:"ul"},"service_role : (\ud544\uc218) AWS Batch\uac00 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4\ub97c \ud638\ucd9c \ud560\uc218\uc788\uac8c \ud574\uc8fc\ub294 IAM Role(ARN)"),(0,i.kt)("li",{parentName:"ul"},"type : (\ud544\uc218) MANAGED\ub098 UNMANAGED\ub97c \uc120\ud0dd\ud560 \uc218 \uc788\uace0, MANAGED\uc758 \uacbd\uc6b0 compute_resources\uc5d0 \uc138\ubd80 \uc0ac\ud56d\uc744 \uc124\uc815\ud560 \uc218 \uc788\ub2e4.  ")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'resource "aws_batch_job_definition" "default" {\n  name = "fetch_and_run" \n  type = "container"\n\n  container_properties = <<CONTAINER_PROPERTIES\n{\n    "command": [],\n    "image": "823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623",\n    "vcpus": 1,\n    "memory": 512,\n    "volumes": [],\n    "environment": [],\n    "mountPoints": [],\n    "ulimits": [] \n}\nCONTAINER_PROPERTIES\n}\n')),(0,i.kt)("p",{parentName:"li"},'Job Definition \uc815\uc758("aws_batch_job_definition")\uc5d0\uc11c\ub294 Resource spec \ubc0f Command(Docker RUN), Container IMAGE \ub4f1\uc744 \uc120\uc5b8\ud558\uac8c \ub41c\ub2e4.  '),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"name : (\ud544\uc218) Job Definition \uc774\ub984"),(0,i.kt)("li",{parentName:"ul"},"type : (\ud544\uc218) Job Definition \uc720\ud615, ECS\ub85c \ucc98\ub9ac\ud558\uae30 \uc704\ud574 container\ub85c \uc120\ud0dd"),(0,i.kt)("li",{parentName:"ul"},"container_properties : (\uc120\ud0dd) JSON \ud615\ud0dc\ub85c \uc791\uc131\ud558\ub294 container \uc18d\uc131\uc815\ubcf4 (Image, Resources, Command, MountPoint \ub4f1)"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},".circleci/config.yml\uc5d0 CircleCI \ubc84\uc804 \uba85\uc2dc \ubc0f \uad00\ub828 orb(ecr,ecs,s3,cli) \ucd94\uac00",(0,i.kt)("br",{parentName:"p"}),"\n","\uae30\ubcf8\uc801\uc73c\ub85c 2.1\ub85c \uc124\uc815\uc744 \ud574\uc57c ecs, eks orb \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"version: 2.1\n  orbs:\n    aws-ecr: circleci/aws-ecr@6.1.0\n    aws-ecs: circleci/aws-ecs@0.0.8\n    aws-s3: circleci/aws-s3@1.0.11\n    aws-cli: circleci/aws-cli@0.1.13\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"workflow \uad6c\uc131"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"build-and-push-image")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"sh-s3-upload")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy-batch")," \uc21c\uc73c\ub85c \uc21c\ucc28\uc801\uc73c\ub85c pipeline\uad6c\uc131\uc744 \ud558\uc600\ub2e4.  "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"workflows:\n  build-and-deploy:\n    jobs:\n      - aws-ecr/build-and-push-image:\n          repo: $AWS_RESOURCE_NAME_PREFIX # data-crawler-test\n          tag: v20190623\n          # create-repo: true\n          # dockerfile: Dockerfile\n      - sh-s3-upload:\n          name: sh-s3-upload\n          requires:\n            - aws-ecr/build-and-push-image\n      - deploy-batch:\n          name: deploy-batch\n          requires:\n            - sh-s3-upload\n")),(0,i.kt)("p",{parentName:"li"},"\uae30\ubcf8\uc801\uc73c\ub85c CircleCI\uc5d0\uc11c\ub294 orb job\uc744 ","[orb name]","/","[predefined-job]"," \ud615\uc2dd\uc73c\ub85c \uc120\uc5b8\ud55c\ub2e4.  "),(0,i.kt)("p",{parentName:"li"},"I. \uccab\ubc88\uc9f8 step\uc5d0\uc11c\ub294 container image\ub97c build\ud558\uace0 push\ud558\ub294 Job\uc744 \uc218\ud589\ud558\ubbc0\ub85c ",(0,i.kt)("inlineCode",{parentName:"p"},"aws-ecr/build-and-push-image"),"\uc744 \uc120\uc5b8\ud55c\ub2e4.",(0,i.kt)("br",{parentName:"p"}),"\n","\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,i.kt)("a",{parentName:"p",href:"https://circleci.com/orbs/registry/orb/circleci/aws-ecr"},"https://circleci.com/orbs/registry/orb/circleci/aws-ecr"),"\ub97c \ud655\uc778\ud558\uc790.  "),(0,i.kt)("p",{parentName:"li"},"II. \ub450\ubc88\uc9f8 step\uc5d0\uc11c\ub294 S3\uc5d0 \ubc30\uce58\uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc62c\ub9ac\ub294 Custom Job\uc744 \uc218\ud589\ud55c\ub2e4.  Job\uc740 Step\uc758 \ubaa8\uc74c\uc73c\ub85c \uc120\ud589\ub418\uc5b4\uc57c\ud560 Job\uc740 \uc0c1\uc704\uc5d0 ",(0,i.kt)("inlineCode",{parentName:"p"},"requires:")," \uc5d0\uc11c \uc120\uc5b8\ud558\uba74 \ub41c\ub2e4.  "),(0,i.kt)("p",{parentName:"li"},"III. \uc138\ubc88\uc9f8 step\uc5d0\uc11c\ub294 AWS Batch job definition\uc758 container image\ub97c \uad50\uccb4(revision \ubcc0\uacbd)\ud558\ub294 Custom Job\uc744 \uc218\ud589\ud55c\ub2e4.  ")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"custom job \uad6c\uc131\nWorkflow\uc5d0\uc11c \uc120\uc5b8\ud55c Custom Job\uc758 \uc0c1\uc138 definition\uc744 \uae30\uc7ac\ud55c\ub2e4.  "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'jobs:\n  sh-s3-upload:\n    docker:\n      - image: \'circleci/python:2.7\'\n    steps:\n      - checkout\n      - aws-s3/copy:\n          from: ./myjob.sh\n          to: \'s3://batch-ecr-test/myjob.sh\'\n  deploy-batch:\n    executor: aws-cli/default\n    steps:\n      - aws-cli/install\n      - run:\n          name: Update AWS Batch Job\n          command: |\n            aws batch register-job-definition --job-definition-name fetch_and_run --type container --container-properties \'{ "image": "823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623", "vcpus": 1, "memory": 512}\'\n')),(0,i.kt)("p",{parentName:"li"},"I. ",(0,i.kt)("inlineCode",{parentName:"p"},"sh-s3-upload")," \uc5d0\uc11c\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"aws-s3/copy")," \ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6d0\ud558\ub294 S3\ubc84\ud0b7\uc5d0 \uc0ac\uc6a9\ud560 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc5c5\ub85c\ub4dc \ud55c\ub2e4.  ",(0,i.kt)("inlineCode",{parentName:"p"},"checkout"),"\uc5d0\uc11c\ub294 \ud604\uc7ac \uc0c1\ud0dc\uc758 git repo\ub97c clone\ud558\uac8c \ub41c\ub2e4.  "),(0,i.kt)("p",{parentName:"li"},"II. ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy-batch")," \uc5d0\uc11c\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"aws-cli/install")," \ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\uc874\uc5d0 \uc791\uc131\ud55c Batch Job definition\uc744 awscli\ub85c \uc6d0\ud558\ub294 \uc0c8\ub85c\uc6b4 image\ub85c \uc5c5\ub370\uc774\ud2b8 \ud558\uac8c \ub41c\ub2e4.  "))),(0,i.kt)("h2",{id:"circleci-\uc2e4\ud589"},"CircleCI \uc2e4\ud589"),(0,i.kt)("p",null,"\ube4c\ub4dc \ubc0f \ubc30\ud3ec\uacfc\uc815\uc744 \uac04\ub2e8\ud558\uac8c \uc124\uba85\ud558\uba74 \ucf54\ub4dc\uac00 \uc5c5\ub370\uc774\ud2b8\ub418\uba74 CircleCI\ub294 \ud574\ub2f9 \uc800\uc7a5\uc18c\uc758 ",(0,i.kt)("inlineCode",{parentName:"p"},".circleci/config.yml")," \uc744 \uae30\uc900\uc73c\ub85c \ube4c\ub4dc \ubc0f \ubc30\ud3ec\ub97c \uc2dc\uc791\ud558\uac8c \ub41c\ub2e4.  "),(0,i.kt)("h2",{id:"readmemd\uc5d0-build-status-badge-\ub2ec\uae30"},"README.md\uc5d0 Build Status Badge \ub2ec\uae30"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://circleci.com/docs/2.0/status-badges/"},"https://circleci.com/docs/2.0/status-badges/"),"  "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"badge",src:n(22711).Z,width:"1000",height:"660"}),"\n\uc704 \ub9c1\ud06c\uc640 \uc124\uc815\uc744 \ucc38\uace0\ud558\uc5ec \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 Build Statud Badge\ub97c \ub2ec \uc218 \uc788\ub2e4.  "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"badge",src:n(29960).Z,width:"854",height:"374"})),(0,i.kt)("h2",{id:"\uc815\ub9ac"},"\uc815\ub9ac"),(0,i.kt)("p",null,"\uc774\ubc88\uc5d0\ub294 CircleCI\ub97c \uac00\uc9c0\uace0 AWS Batch job\uc744 \uad6c\uc131\ud558\ub294 \ub370\ubaa8\ub97c \uc9c4\ud589\ud558\uc600\ub2e4.  "),(0,i.kt)("p",null,"\uc5bc\ub9c8\uc804\uc778\uac00\uc5d0\ub3c4 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/leoh0"},"\uc5b4\ud615\ubd80\ud615"),"\ub2d8\uaed8\uc11c\ub3c4 \uc5b8\uae09\ud558\uc2e0 \uc120\uc5b8\uc801\uc778 \uad6c\uc131 \uae30\ubc18\uc5d0 \ucd5c\ub300\ud55c serverless \ud658\uacbd\uc5d0\uc11c\uc758 \ubc30\ud3ec\ub97c \ucd94\uad6c\ud558\uac8c \ub418\ub2e4 \ubcf4\ub2c8 \uc544\ub798\uc640 \uac19\uc740 ",(0,i.kt)("inlineCode",{parentName:"p"},"CI/CD Pipeline \uc2dc\ub098\ub9ac\uc624"),"\ub97c \uad6c\uc0c1\ud558\uac8c \ub418\uc5c8\ub2e4.  "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"cicd",src:n(1507).Z,width:"972",height:"599"})),(0,i.kt)("p",null,"\uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc758 \ube0c\ub79c\uce58(New Feature)\uac00 Git\uc5d0 push\ub418\uba74 \ube4c\ub4dc\uc640 \ud14c\uc2a4\ud2b8\uac00 \ud2b8\ub9ac\uac70\ub418\uc5b4 \uc790\ub3d9\uc73c\ub85c \uc9c4\ud589\ub418\uace0 \ub3d9\uc2dc\uc5d0 \uac1c\ubc1c\uc790\uac00 PR\uc744 \uc791\uc131\ud558\uba74 \ub3d9\ub8cc \ubc0f \ub2f4\ub2f9 \uc0c1\uae09\uc790\uc5d0\uac8c \ucf54\ub4dc \ub9ac\ubdf0\ub97c \ubc1b\uac8c \ub41c\ub2e4.  "),(0,i.kt)("p",null,"\ub9ac\ubdf0\uac00 \ud1b5\uacfc\ub418\uace0 CircleCI\uc5d0\uc11c \ube4c\ub4dc\uac00 \uc131\uacf5\ud588\ub2e4\uba74 \uc2b9\uc778\ub2e8\uacc4\ub97c \ud1b5\ud574 Merge\ub97c \ud558\uace0 CircleCI \uac00 \ud55c \ubc88 \ub354 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud558\uace0 \ubc30\ud3ec\uae4c\uc9c0 \uc218\ud589\ud558\uac8c \ub41c\ub2e4.  "),(0,i.kt)("p",null,"ECS\ub098 Batch\ub85c \ubc30\ud3ec\ub294 CircleCI\ub97c \ud1b5\ud574 \uc9c1\uc811 \ubc30\ud3ec\ub97c \ud558\uace0 EC2\ub098 EKS\ub85c\uc758 \ubc30\ud3ec\ub294 Terraform \ubc0f ArgoCD\ub97c \ud1b5\ud574 \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4.  "),(0,i.kt)("p",null,"\ub2e4\uc74c\ubc88 \ud3ec\uc2a4\ud305\uc5d0\ub294 \uc704 \uadf8\ub9bc \uae30\ubc18\uc73c\ub85c CircleCI\uc640 ArgoCD\ub97c \ud65c\uc6a9\ud558\uc5ec EKS\uae30\ubc18 \ubc30\ud3ec\uacfc\uc815\uc744 \uc815\ub9ac\ud560 \uc608\uc815\uc774\ub2e4.  "),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://ko-fi.com/X8X1W6OZ"},(0,i.kt)("img",{parentName:"a",src:"https://www.ko-fi.com/img/githubbutton_sm.svg",alt:"ko-fi"}))))}d.isMDXComponent=!0},29960:function(e,t,n){t.Z=n.p+"assets/images/circle-badge-ss-0aa981c32cb500f9508dd854153420ae.png"},22711:function(e,t,n){t.Z=n.p+"assets/images/circle-badge-24ad544bce8cfd19a433ce635078fa5c.png"},1507:function(e,t,n){t.Z=n.p+"assets/images/circlecicd-01a869820c0d70040071bbc7a5704933.png"}}]);